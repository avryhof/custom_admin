var rwindow,rdocument;if(typeof RELANG==="undefined"){var RELANG={}}var RLANG={html:"HTML",video:"Insert Video",image:"Insert Image",table:"Table",link:"Link",link_insert:"Insert link",unlink:"Unlink",formatting:"Formatting",paragraph:"Paragraph",quote:"Quote",code:"Code",header1:"Header 1",header2:"Header 2",header3:"Header 3",header4:"Header 4",bold:"Bold",italic:"Italic",fontcolor:"Font Color",backcolor:"Back Color",unorderedlist:"Unordered List",orderedlist:"Ordered List",outdent:"Outdent",indent:"Indent",cancel:"Cancel",insert:"Insert",save:"Save",_delete:"Delete",insert_table:"Insert Table",insert_row_above:"Add Row Above",insert_row_below:"Add Row Below",insert_column_left:"Add Column Left",insert_column_right:"Add Column Right",delete_column:"Delete Column",delete_row:"Delete Row",delete_table:"Delete Table",rows:"Rows",columns:"Columns",add_head:"Add Head",delete_head:"Delete Head",title:"Title",image_position:"Position",none:"None",left:"Left",right:"Right",image_web_link:"Image Web Link",text:"Text",mailto:"Email",web:"URL",video_html_code:"Video Embed Code",file:"Insert File",upload:"Upload",download:"Download",choose:"Choose",or_choose:"Or choose",drop_file_here:"Drop file here",align_left:"Align text to the left",align_center:"Center text",align_right:"Align text to the right",align_justify:"Justify text",horizontalrule:"Insert Horizontal Rule",deleted:"Deleted",anchor:"Anchor",link_new_tab:"Open link in new tab",underline:"Underline",alignment:"Alignment"};(function(c){jQuery.fn.redactor=function(a){return this.each(function(){var b=c(this);var f=b.data("redactor");if(!f){b.data("redactor",(f=new d(this,a)))}})};var d=function(a,b){this.$el=c(a);if(typeof b!=="undefined"&&typeof b.lang!=="undefined"&&b.lang!=="en"&&typeof RELANG[b.lang]!=="undefined"){RLANG=RELANG[b.lang]}this.opts=c.extend({iframe:false,css:false,lang:"en",direction:"ltr",callback:false,keyupCallback:false,keydownCallback:false,execCommandCallback:false,plugins:false,cleanup:true,focus:false,tabindex:false,autoresize:true,minHeight:false,fixed:false,fixedTop:0,fixedBox:false,source:true,shortcuts:true,mobile:true,air:false,wym:false,convertLinks:true,convertDivs:true,protocol:"http://",autosave:false,autosaveCallback:false,interval:60,imageGetJson:false,imageUpload:false,imageUploadCallback:false,imageUploadErrorCallback:false,fileUpload:false,fileUploadCallback:false,fileUploadErrorCallback:false,uploadCrossDomain:false,uploadFields:false,observeImages:true,overlay:true,allowedTags:["form","input","button","select","option","datalist","output","textarea","fieldset","legend","section","header","hgroup","aside","footer","article","details","nav","progress","time","canvas","code","span","div","label","a","br","p","b","i","del","strike","u","img","video","source","track","audio","iframe","object","embed","param","blockquote","mark","cite","small","ul","ol","li","hr","dl","dt","dd","sup","sub","big","pre","code","figure","figcaption","strong","em","table","tr","td","th","tbody","thead","tfoot","h1","h2","h3","h4","h5","h6"],toolbarExternal:false,buttonsCustom:{},buttonsAdd:[],buttons:["html","|","formatting","|","bold","italic","deleted","|","unorderedlist","orderedlist","outdent","indent","|","image","video","file","table","link","|","fontcolor","backcolor","|","alignment","|","horizontalrule"],airButtons:["formatting","|","bold","italic","deleted","|","unorderedlist","orderedlist","outdent","indent","|","fontcolor","backcolor"],formattingTags:["p","blockquote","pre","h1","h2","h3","h4"],activeButtons:["deleted","italic","bold","underline","unorderedlist","orderedlist"],activeButtonsStates:{b:"bold",strong:"bold",i:"italic",em:"italic",del:"deleted",strike:"deleted",ul:"unorderedlist",ol:"orderedlist",u:"underline"},colors:["#ffffff","#000000","#eeece1","#1f497d","#4f81bd","#c0504d","#9bbb59","#8064a2","#4bacc6","#f79646","#ffff00","#f2f2f2","#7f7f7f","#ddd9c3","#c6d9f0","#dbe5f1","#f2dcdb","#ebf1dd","#e5e0ec","#dbeef3","#fdeada","#fff2ca","#d8d8d8","#595959","#c4bd97","#8db3e2","#b8cce4","#e5b9b7","#d7e3bc","#ccc1d9","#b7dde8","#fbd5b5","#ffe694","#bfbfbf","#3f3f3f","#938953","#548dd4","#95b3d7","#d99694","#c3d69b","#b2a2c7","#b7dde8","#fac08f","#f2c314","#a5a5a5","#262626","#494429","#17365d","#366092","#953734","#76923c","#5f497a","#92cddc","#e36c09","#c09100","#7f7f7f","#0c0c0c","#1d1b10","#0f243e","#244061","#632423","#4f6128","#3f3151","#31859b","#974806","#7f6000"],emptyHtml:"<p><br /></p>",buffer:false,visual:true,modal_file:String()+'<div id="redactor_modal_content"><form id="redactorUploadFileForm" method="post" action="" enctype="multipart/form-data"><label>Name (optional)</label><input type="text" id="redactor_filename" class="redactor_input" /><div style="margin-top: 7px;"><input type="file" id="redactor_file" name="file" /></div></form><br></div>',modal_image_edit:String()+'<div id="redactor_modal_content"><label>'+RLANG.title+'</label><input id="redactor_file_alt" class="redactor_input" /><label>'+RLANG.link+'</label><input id="redactor_file_link" class="redactor_input" /><label>'+RLANG.image_position+'</label><select id="redactor_form_image_align"><option value="none">'+RLANG.none+'</option><option value="left">'+RLANG.left+'</option><option value="right">'+RLANG.right+'</option></select></div><div id="redactor_modal_footer"><a href="javascript:void(null);" id="redactor_image_delete_btn" class="redactor_modal_btn">'+RLANG._delete+'</a>&nbsp;&nbsp;&nbsp;<a href="javascript:void(null);" class="redactor_modal_btn redactor_btn_modal_close">'+RLANG.cancel+'</a><input type="button" name="save" class="redactor_modal_btn" id="redactorSaveBtn" value="'+RLANG.save+'" /></div>',modal_image:String()+'<div id="redactor_modal_content"><div id="redactor_tabs"><a href="javascript:void(null);" class="redactor_tabs_act">'+RLANG.upload+'</a><a href="javascript:void(null);">'+RLANG.choose+'</a><a href="javascript:void(null);">'+RLANG.link+'</a></div><form id="redactorInsertImageForm" method="post" action="" enctype="multipart/form-data"><div id="redactor_tab1" class="redactor_tab"><input type="file" id="redactor_file" name="file" /></div><div id="redactor_tab2" class="redactor_tab" style="display: none;"><div id="redactor_image_box"></div></div></form><div id="redactor_tab3" class="redactor_tab" style="display: none;"><label>'+RLANG.image_web_link+'</label><input type="text" name="redactor_file_link" id="redactor_file_link" class="redactor_input"  /></div></div><div id="redactor_modal_footer"><a href="javascript:void(null);" class="redactor_modal_btn redactor_btn_modal_close">'+RLANG.cancel+'</a><input type="button" name="upload" class="redactor_modal_btn" id="redactor_upload_btn" value="'+RLANG.insert+'" /></div>',modal_link:String()+'<div id="redactor_modal_content"><form id="redactorInsertLinkForm" method="post" action=""><div id="redactor_tabs"><a href="javascript:void(null);" class="redactor_tabs_act">URL</a><a href="javascript:void(null);">Email</a><a href="javascript:void(null);">'+RLANG.anchor+'</a></div><input type="hidden" id="redactor_tab_selected" value="1" /><div class="redactor_tab" id="redactor_tab1"><label>URL</label><input type="text" id="redactor_link_url" class="redactor_input"  /><label>'+RLANG.text+'</label><input type="text" class="redactor_input redactor_link_text" id="redactor_link_url_text" /><label><input type="checkbox" id="redactor_link_blank"> '+RLANG.link_new_tab+'</label></div><div class="redactor_tab" id="redactor_tab2" style="display: none;"><label>Email</label><input type="text" id="redactor_link_mailto" class="redactor_input" /><label>'+RLANG.text+'</label><input type="text" class="redactor_input redactor_link_text" id="redactor_link_mailto_text" /></div><div class="redactor_tab" id="redactor_tab3" style="display: none;"><label>'+RLANG.anchor+'</label><input type="text" class="redactor_input" id="redactor_link_anchor"  /><label>'+RLANG.text+'</label><input type="text" class="redactor_input redactor_link_text" id="redactor_link_anchor_text" /></div></form></div><div id="redactor_modal_footer"><a href="javascript:void(null);" class="redactor_modal_btn redactor_btn_modal_close">'+RLANG.cancel+'</a><input type="button" class="redactor_modal_btn" id="redactor_insert_link_btn" value="'+RLANG.insert+'" /></div>',modal_table:String()+'<div id="redactor_modal_content"><label>'+RLANG.rows+'</label><input type="text" size="5" value="2" id="redactor_table_rows" /><label>'+RLANG.columns+'</label><input type="text" size="5" value="3" id="redactor_table_columns" /></div><div id="redactor_modal_footer"><a href="javascript:void(null);" class="redactor_modal_btn redactor_btn_modal_close">'+RLANG.cancel+'</a><input type="button" name="upload" class="redactor_modal_btn" id="redactor_insert_table_btn" value="'+RLANG.insert+'" /></div>',modal_video:String()+'<div id="redactor_modal_content"><form id="redactorInsertVideoForm"><label>'+RLANG.video_html_code+'</label><textarea id="redactor_insert_video_area" style="width: 99%; height: 160px;"></textarea></form></div><div id="redactor_modal_footer"><a href="javascript:void(null);" class="redactor_modal_btn redactor_btn_modal_close">'+RLANG.cancel+'</a><input type="button" class="redactor_modal_btn" id="redactor_insert_video_btn" value="'+RLANG.insert+'" /></div>',toolbar:{html:{title:RLANG.html,func:"toggle"},formatting:{title:RLANG.formatting,func:"show",dropdown:{p:{title:RLANG.paragraph,exec:"formatblock"},blockquote:{title:RLANG.quote,exec:"formatblock",className:"redactor_format_blockquote"},pre:{title:RLANG.code,exec:"formatblock",className:"redactor_format_pre"},h1:{title:RLANG.header1,exec:"formatblock",className:"redactor_format_h1"},h2:{title:RLANG.header2,exec:"formatblock",className:"redactor_format_h2"},h3:{title:RLANG.header3,exec:"formatblock",className:"redactor_format_h3"},h4:{title:RLANG.header4,exec:"formatblock",className:"redactor_format_h4"}}},bold:{title:RLANG.bold,exec:"bold"},italic:{title:RLANG.italic,exec:"italic"},deleted:{title:RLANG.deleted,exec:"strikethrough"},underline:{title:RLANG.underline,exec:"underline"},unorderedlist:{title:"&bull; "+RLANG.unorderedlist,exec:"insertunorderedlist"},orderedlist:{title:"1. "+RLANG.orderedlist,exec:"insertorderedlist"},outdent:{title:"< "+RLANG.outdent,exec:"outdent"},indent:{title:"> "+RLANG.indent,exec:"indent"},image:{title:RLANG.image,func:"showImage"},video:{title:RLANG.video,func:"showVideo"},file:{title:RLANG.file,func:"showFile"},table:{title:RLANG.table,func:"show",dropdown:{insert_table:{title:RLANG.insert_table,func:"showTable"},separator_drop1:{name:"separator"},insert_row_above:{title:RLANG.insert_row_above,func:"insertRowAbove"},insert_row_below:{title:RLANG.insert_row_below,func:"insertRowBelow"},insert_column_left:{title:RLANG.insert_column_left,func:"insertColumnLeft"},insert_column_right:{title:RLANG.insert_column_right,func:"insertColumnRight"},separator_drop2:{name:"separator"},add_head:{title:RLANG.add_head,func:"addHead"},delete_head:{title:RLANG.delete_head,func:"deleteHead"},separator_drop3:{name:"separator"},delete_column:{title:RLANG.delete_column,func:"deleteColumn"},delete_row:{title:RLANG.delete_row,func:"deleteRow"},delete_table:{title:RLANG.delete_table,func:"deleteTable"}}},link:{title:RLANG.link,func:"show",dropdown:{link:{title:RLANG.link_insert,func:"showLink"},unlink:{title:RLANG.unlink,exec:"unlink"}}},fontcolor:{title:RLANG.fontcolor,func:"show"},backcolor:{title:RLANG.backcolor,func:"show"},alignment:{title:RLANG.alignment,func:"show",dropdown:{alignleft:{title:RLANG.align_left,exec:"JustifyLeft"},aligncenter:{title:RLANG.align_center,exec:"JustifyCenter"},alignright:{title:RLANG.align_right,exec:"JustifyRight"},justify:{title:RLANG.align_justify,exec:"JustifyFull"}}},alignleft:{exec:"JustifyLeft",title:RLANG.align_left},aligncenter:{exec:"JustifyCenter",title:RLANG.align_center},alignright:{exec:"JustifyRight",title:RLANG.align_right},justify:{exec:"JustifyFull",title:RLANG.align_justify},horizontalrule:{exec:"inserthorizontalrule",title:RLANG.horizontalrule}}},b,this.$el.data());this.dropdowns=[];this.init()};d.prototype={init:function(){this.height=this.$el.css("height");this.width=this.$el.css("width");rdocument=this.document=document;rwindow=this.window=window;if(this.opts.mobile===false&&this.isMobile()){this.build(true);return false}if(this.opts.iframe){this.opts.autoresize=false}if(this.opts.air){this.opts.buttons=this.opts.airButtons}else{if(this.opts.toolbar!==false){if(this.opts.source===false){var b=this.opts.buttons.indexOf("html");var a=this.opts.buttons[b+1];this.opts.buttons.splice(b,1);if(typeof a!=="undefined"&&a==="|"){this.opts.buttons.splice(b,1)}}c.extend(this.opts.toolbar,this.opts.buttonsCustom);c.each(this.opts.buttonsAdd,c.proxy(function(h,e){this.opts.buttons.push(e)},this))}}if(this.opts.toolbar!==false){c.each(this.opts.toolbar.formatting.dropdown,c.proxy(function(h,e){if(c.inArray(h,this.opts.formattingTags)=="-1"){delete this.opts.toolbar.formatting.dropdown[h]}},this))}function f(){this.enableAir();this.buildToolbar();if(typeof this.opts.plugins==="object"){c.each(this.opts.plugins,c.proxy(function(h,g){if(typeof RedactorPlugins[g]!=="undefined"){c.extend(this,RedactorPlugins[g]);if(typeof RedactorPlugins[g].init!=="undefined"){this.init()}}},this))}if(this.opts.activeButtons!==false&&this.opts.toolbar!==false){var k=c.proxy(function(){this.observeFormatting()},this);this.$editor.click(k).keyup(k)}var e=false;if(this.browser("webkit")&&navigator.userAgent.indexOf("Chrome")===-1){var l=this.browser("version").split(".");if(l[0]<536){e=true}}if(this.isMobile(true)===false&&e===false){this.$editor.bind("paste",c.proxy(function(h){if(this.opts.cleanup===false){return true}this.pasteRunning=true;this.setBuffer();if(this.opts.autoresize===true){this.saveScroll=this.document.body.scrollTop}else{this.saveScroll=this.$editor.scrollTop()}var g=this.extractContent();setTimeout(c.proxy(function(){var n=this.extractContent();this.$editor.append(g);this.restoreSelection();var i=this.getFragmentHtml(n);this.pasteCleanUp(i);this.pasteRunning=false},this),1)},this))}this.keyup();this.keydown();if(this.opts.autosave!==false){this.autoSave()}setTimeout(c.proxy(function(){this.observeImages();this.observeTables()},this),1);if(this.browser("mozilla")){this.$editor.click(c.proxy(function(){this.saveSelection()},this));try{this.document.execCommand("enableObjectResizing",false,false);this.document.execCommand("enableInlineTableEditing",false,false)}catch(j){}}if(this.opts.focus){setTimeout(c.proxy(function(){this.$editor.focus()},this),1)}if(this.opts.fixed){this.observeScroll();c(document).scroll(c.proxy(this.observeScroll,this))}if(typeof this.opts.callback==="function"){this.opts.callback(this)}if(this.opts.toolbar!==false){this.$toolbar.find("a").attr("tabindex","-1")}}this.build(false,f)},shortcuts:function(a,b){a.preventDefault();this.execCommand(b,false)},keyup:function(){this.$editor.keyup(c.proxy(function(a){var b=a.keyCode||a.which;if(this.browser("mozilla")&&!this.pasteRunning){this.saveSelection()}if(typeof this.opts.keyupCallback==="function"){this.opts.keyupCallback(this,a)}if(b===8||b===46){this.observeImages();return this.formatEmpty(a)}if(b===13&&!a.shiftKey&&!a.ctrlKey&&!a.metaKey){if(this.browser("webkit")){this.formatNewLine(a)}if(this.opts.convertLinks){this.$editor.linkify()}}this.syncCode()},this))},keydown:function(){this.$editor.keydown(c.proxy(function(a){var m=a.keyCode||a.which;var l=this.getParentNode();var b=this.getCurrentNode();var e=false;var k=a.ctrlKey||a.metaKey;if((l||b)&&(c(l).get(0).tagName==="PRE"||c(b).get(0).tagName==="PRE")){e=true}if(typeof this.opts.keydownCallback==="function"){this.opts.keydownCallback(this,a)}if(k&&this.opts.shortcuts){if(m===90){if(this.opts.buffer!==false){a.preventDefault();this.getBuffer()}else{if(a.shiftKey){this.shortcuts(a,"redo")}else{this.shortcuts(a,"undo")}}}else{if(m===77){this.shortcuts(a,"removeFormat")}else{if(m===66){this.shortcuts(a,"bold")}else{if(m===73){this.shortcuts(a,"italic")}else{if(m===74){this.shortcuts(a,"insertunorderedlist")}else{if(m===75){this.shortcuts(a,"insertorderedlist")}else{if(m===76){this.shortcuts(a,"superscript")}else{if(m===72){this.shortcuts(a,"subscript")}}}}}}}}}if(!k&&m!==90){this.opts.buffer=false}if(e===true&&m===13){a.preventDefault();var n=c(b).parent().text();this.insertNodeAtCaret(this.document.createTextNode("\r\n"));if(n.search(/\s$/)==-1){this.insertNodeAtCaret(this.document.createTextNode("\r\n"))}this.syncCode();return false}if(this.opts.shortcuts&&!a.shiftKey&&m===9){if(e===false){this.shortcuts(a,"indent")}else{a.preventDefault();this.insertNodeAtCaret(this.document.createTextNode("\t"));this.syncCode();return false}}else{if(this.opts.shortcuts&&a.shiftKey&&m===9){this.shortcuts(a,"outdent")}}if(this.browser("webkit")&&navigator.userAgent.indexOf("Chrome")===-1){return this.safariShiftKeyEnter(a,m)}},this))},build:function(l,a){if(l!==true){this.$box=c('<div class="redactor_box"></div>');if(this.opts.air){this.air=c('<div class="redactor_air" style="display: none;"></div>')}this.$content=null;function b(){this.$editor=this.$content.contents().find("body").attr("contenteditable",true).attr("dir",this.opts.direction);rdocument=this.document=this.$editor[0].ownerDocument;rwindow=this.window=this.document.defaultView||window;if(this.opts.css!==false){this.$content.contents().find("head").append('<link rel="stylesheet" href="'+this.opts.css+'" />')}this.$editor.html(k);if(a){a.call(this);a=null}}this.textareamode=true;if(this.$el.get(0).tagName==="TEXTAREA"){if(this.opts.iframe){var j=this;this.$content=c('<iframe style="width: 100%;" frameborder="0"></iframe>').load(function(){b.call(j)})}else{this.$content=this.$editor=c("<div></div>")}var m=this.$el.get(0).className.split(/\s+/);c.each(m,c.proxy(function(f,e){this.$content.addClass("redactor_"+e)},this))}else{this.textareamode=false;this.$content=this.$editor=this.$el;this.$el=c('<textarea name="'+this.$editor.attr("id")+'"></textarea>').css("height",this.height)}if(this.$editor){this.$editor.addClass("redactor_editor").attr("contenteditable",true).attr("dir",this.opts.direction)}if(this.opts.tabindex!==false){this.$content.attr("tabindex",this.opts.tabindex)}if(this.opts.minHeight!==false){this.$content.css("min-height",this.opts.minHeight+"px")}if(this.opts.wym===true){this.$content.addClass("redactor_editor_wym")}if(this.opts.autoresize===false){this.$content.css("height",this.height)}this.$el.hide();var k="";if(this.textareamode){k=this.$el.val();k=this.savePreCode(k);this.$box.insertAfter(this.$el).append(this.$content).append(this.$el)}else{k=this.$editor.html();k=this.savePreCode(k);this.$box.insertAfter(this.$content).append(this.$el).append(this.$editor)}k=this.paragraphy(k);if(this.$editor){this.$editor.html(k)}if(this.textareamode===false){this.syncCode()}}else{if(this.$el.get(0).tagName!=="TEXTAREA"){var k=this.$el.val();var n=c('<textarea name="'+this.$editor.attr("id")+'"></textarea>').css("height",this.height).val(k);this.$el.hide();this.$el.after(n)}}if(a&&this.$editor){a.call(this)}},enableAir:function(){if(this.opts.air===false){return false}this.air.hide();this.$editor.bind("textselect",c.proxy(function(a){this.showAir(a)},this));this.$editor.bind("textunselect",c.proxy(function(){this.air.hide()},this))},showAir:function(a){c(".redactor_air").hide();var h=this.air.innerWidth();var b=a.clientX;if(c(this.document).width()<(b+h)){b=b-h}var e=a.clientY+c(document).scrollTop()+14;if(this.opts.iframe===true){e=e+this.$box.position().top;b=b+this.$box.position().left}this.air.css({left:b+"px",top:e+"px"}).show()},syncCode:function(){this.$el.val(this.$editor.html())},setCode:function(a){a=this.stripTags(a);this.$editor.html(a).focus();this.syncCode()},getCode:function(){var a="";if(this.opts.visual){a=this.$editor.html()}else{a=this.$el.val()}return this.stripTags(a)},insertHtml:function(a){this.$editor.focus();this.pasteHtmlAtCaret(a);this.observeImages();this.syncCode()},pasteHtmlAtCaret:function(m){var b,n;if(this.document.getSelection){b=this.window.getSelection();if(b.getRangeAt&&b.rangeCount){n=b.getRangeAt(0);n.deleteContents();var l=this.document.createElement("div");l.innerHTML=m;var a=this.document.createDocumentFragment(),j,k;while(j=l.firstChild){k=a.appendChild(j)}n.insertNode(a);if(k){n=n.cloneRange();n.setStartAfter(k);n.collapse(true);b.removeAllRanges();b.addRange(n)}}}else{if(this.document.selection&&this.document.selection.type!="Control"){this.document.selection.createRange().pasteHTML(m)}}},destroy:function(){var a=this.getCode();if(this.textareamode){this.$box.after(this.$el);this.$box.remove();this.$el.height(this.height).val(a).show()}else{this.$box.after(this.$editor);this.$box.remove();this.$editor.removeClass("redactor_editor").removeClass("redactor_editor_wym").attr("contenteditable",false).html(a).show()}if(this.opts.toolbarExternal){c(this.opts.toolbarExternal).empty()}c(".redactor_air").remove();for(var b=0;b<this.dropdowns.length;b++){this.dropdowns[b].remove();delete (this.dropdowns[b])}if(this.opts.autosave!==false){clearInterval(this.autosaveInterval)}},observeFormatting:function(){var b=this.getCurrentNode();this.inactiveAllButtons();c.each(this.opts.activeButtonsStates,c.proxy(function(h,e){if(c(b).closest(h,this.$editor.get()[0]).length!=0){this.setBtnActive(e)}},this));var f=c(b).closest(["p","div","h1","h2","h3","h4","h5","h6","blockquote","td"]);if(typeof f[0]!=="undefined"&&typeof f[0].elem!=="undefined"&&c(f[0].elem).size()!=0){var a=c(f[0].elem).css("text-align");switch(a){case"right":this.setBtnActive("alignright");break;case"center":this.setBtnActive("aligncenter");break;case"justify":this.setBtnActive("justify");break;default:this.setBtnActive("alignleft");break}}},observeImages:function(){if(this.opts.observeImages===false){return false}this.$editor.find("img").each(c.proxy(function(b,a){if(this.browser("msie")){c(a).attr("unselectable","on")}this.resizeImage(a)},this))},observeTables:function(){this.$editor.find("table").click(c.proxy(this.tableObserver,this))},observeScroll:function(){var h=c(this.document).scrollTop();var a=this.$box.offset().top;var b=0;if(h>a){var g="100%";if(this.opts.fixedBox){b=this.$box.offset().left;g=this.$box.innerWidth()}this.fixed=true;this.$toolbar.css({position:"fixed",width:g,zIndex:1005,top:this.opts.fixedTop+"px",left:b})}else{this.fixed=false;this.$toolbar.css({position:"relative",width:"auto",zIndex:1,top:0,left:b})}},setBuffer:function(){this.saveSelection();this.opts.buffer=this.$editor.html()},getBuffer:function(){if(this.opts.buffer===false){return false}this.$editor.html(this.opts.buffer);if(!this.browser("msie")){this.restoreSelection()}this.opts.buffer=false},execCommand:function(q,s){if(this.opts.visual==false){this.$el.focus();return false}try{var b;if(q==="inserthtml"){if(this.browser("msie")){this.$editor.focus();this.document.selection.createRange().pasteHTML(s)}else{this.pasteHtmlAtCaret(s)}this.observeImages()}else{if(q==="unlink"){b=this.getParentNode();if(c(b).get(0).tagName==="A"){c(b).replaceWith(c(b).text())}else{this.execRun(q,s)}}else{if(q==="JustifyLeft"||q==="JustifyCenter"||q==="JustifyRight"||q==="JustifyFull"){b=this.getCurrentNode();var a=c(b).get(0).tagName;if(this.opts.iframe===false&&c(b).parents(".redactor_editor").size()==0){return false}var o=["P","DIV","H1","H2","H3","H4","H5","H6","BLOCKQUOTE","TD"];if(c.inArray(a,o)!=-1){var m=false;if(q==="JustifyCenter"){m="center"}else{if(q==="JustifyRight"){m="right"}else{if(q==="JustifyFull"){m="justify"}}}if(m===false){c(b).css("text-align","")}else{c(b).css("text-align",m)}}else{this.execRun(q,s)}}else{if(q==="formatblock"&&s==="blockquote"){b=this.getCurrentNode();if(c(b).get(0).tagName==="BLOCKQUOTE"){if(this.browser("msie")){var p=c("<p>"+c(b).html()+"</p>");c(b).replaceWith(p)}else{this.execRun(q,"p")}}else{if(c(b).get(0).tagName==="P"){var e=c(b).parent();if(c(e).get(0).tagName==="BLOCKQUOTE"){var p=c("<p>"+c(b).html()+"</p>");c(e).replaceWith(p);this.setSelection(p[0],0,p[0],0)}else{if(this.browser("msie")){var p=c("<blockquote>"+c(b).html()+"</blockquote>");c(b).replaceWith(p)}else{this.execRun(q,s)}}}else{this.execRun(q,s)}}}else{if(q==="formatblock"&&(s==="pre"||s==="p")){b=this.getParentNode();if(c(b).get(0).tagName==="PRE"){c(b).replaceWith("<p>"+this.encodeEntities(c(b).text())+"</p>")}else{this.execRun(q,s)}}else{if(q==="inserthorizontalrule"&&this.browser("msie")){this.$editor.focus()}if(q==="formatblock"&&this.browser("mozilla")){this.$editor.focus()}this.execRun(q,s)}}}}}if(q==="inserthorizontalrule"){this.$editor.find("hr").removeAttr("id")}this.syncCode();if(this.oldIE()){this.$editor.focus()}if(typeof this.opts.execCommandCallback==="function"){this.opts.execCommandCallback(this,q)}if(this.opts.air){this.air.hide()}}catch(n){}},execRun:function(b,a){if(b==="formatblock"&&this.browser("msie")){a="<"+a+">"}this.document.execCommand(b,false,a)},formatNewLine:function(b){var e=this.getParentNode();if(e.nodeName==="DIV"&&e.className==="redactor_editor"){var h=c(this.getCurrentNode());if(h.get(0).tagName==="DIV"&&(h.html()===""||h.html()==="<br>")){var a=c("<p>").append(h.clone().get(0).childNodes);h.replaceWith(a);a.html("<br />");this.setSelection(a[0],0,a[0],0)}}},safariShiftKeyEnter:function(a,b){if(a.shiftKey&&b===13){a.preventDefault();this.insertNodeAtCaret(c("<span><br /></span>").get(0));this.syncCode();return false}else{return true}},formatEmpty:function(a){var h=c.trim(this.$editor.html());if(this.browser("mozilla")){h=h.replace(/<br>/i,"")}var b=h.replace(/<(?:.|\n)*?>/gm,"");if(h===""||b===""){a.preventDefault();var e=c(this.opts.emptyHtml).get(0);this.$editor.html(e);this.setSelection(e,0,e,0);this.syncCode();return false}else{this.syncCode()}},paragraphy:function(b){b=c.trim(b);if(b===""||b==="<p></p>"){return this.opts.emptyHtml}if(this.opts.convertDivs){b=b.replace(/<div(.*?)>([\w\W]*?)<\/div>/gi,"<p>$2</p>")}var a=function(f,e,j){return f.replace(new RegExp(e,"g"),j)};var h=function(e,f){return a(b,e,f)};var g="(table|thead|tfoot|caption|colgroup|tbody|tr|td|th|div|dl|dd|dt|ul|ol|li|pre|select|form|blockquote|address|math|style|script|object|input|param|p|h[1-6])";b+="\n";h("<br />\\s*<br />","\n\n");h("(<"+g+"[^>]*>)","\n$1");h("(</"+g+">)","$1\n\n");h("\r\n|\r","\n");h("\n\n+","\n\n");h("\n?((.|\n)+?)$","<p>$1</p>\n");h("<p>\\s*?</p>","");h("<p>(<div[^>]*>\\s*)","$1<p>");h("<p>([^<]+)\\s*?(</(div|address|form)[^>]*>)","<p>$1</p>$2");h("<p>\\s*(</?"+g+"[^>]*>)\\s*</p>","$1");h("<p>(<li.+?)</p>","$1");h("<p>\\s*(</?"+g+"[^>]*>)","$1");h("(</?"+g+"[^>]*>)\\s*</p>","$1");h("(</?"+g+"[^>]*>)\\s*<br />","$1");h("<br />(\\s*</?(p|li|div|dl|dd|dt|th|pre|td|ul|ol)[^>]*>)","$1");if(b.indexOf("<pre")!=-1){h("(<pre(.|\n)*?>)((.|\n)*?)</pre>",function(e,f,k,l){return a(f,"\\\\(['\"\\\\])","$1")+a(a(a(l,"<p>","\n"),"</p>|<br />",""),"\\\\(['\"\\\\])","$1")+"</pre>"})}return h("\n</p>$","</p>")},stripTags:function(b){var a=this.opts.allowedTags;var f=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi;return b.replace(f,function(e,h){return c.inArray(h.toLowerCase(),a)>"-1"?e:""})},savePreCode:function(b){var a=b.match(/<pre(.*?)>([\w\W]*?)<\/pre>/gi);if(a!==null){c.each(a,c.proxy(function(i,h){var j=h.match(/<pre(.*?)>([\w\W]*?)<\/pre>/i);j[2]=this.encodeEntities(j[2]);b=b.replace(h,"<pre"+j[1]+">"+j[2]+"</pre>")},this))}return b},encodeEntities:function(a){a=String(a).replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"');return String(a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},cleanupPre:function(a){a=a.replace(/<br>/gi,"\n");a=a.replace(/<\/p>/gi,"\n");a=a.replace(/<\/div>/gi,"\n");var b=this.document.createElement("div");b.innerHTML=a;return b.textContent||b.innerText},pasteCleanUp:function(b){var a=this.getParentNode();if(c(a).get(0).tagName==="PRE"){b=this.cleanupPre(b);this.pasteCleanUpInsert(b);return true}b=b.replace(/<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi,"");b=b.replace(/(&nbsp;){2,}/gi,"&nbsp;");b=b.replace(/<b\sid="internal-source-marker(.*?)">([\w\W]*?)<\/b>/gi,"$2");b=this.stripTags(b);b=b.replace(/<td><\/td>/gi,"[td]");b=b.replace(/<td>&nbsp;<\/td>/gi,"[td]");b=b.replace(/<td><br><\/td>/gi,"[td]");b=b.replace(/<a(.*?)href="(.*?)"(.*?)>([\w\W]*?)<\/a>/gi,'[a href="$2"]$4[/a]');b=b.replace(/<iframe(.*?)>([\w\W]*?)<\/iframe>/gi,"[iframe$1]$2[/iframe]");b=b.replace(/<video(.*?)>([\w\W]*?)<\/video>/gi,"[video$1]$2[/video]");b=b.replace(/<audio(.*?)>([\w\W]*?)<\/audio>/gi,"[audio$1]$2[/audio]");b=b.replace(/<embed(.*?)>([\w\W]*?)<\/embed>/gi,"[embed$1]$2[/embed]");b=b.replace(/<object(.*?)>([\w\W]*?)<\/object>/gi,"[object$1]$2[/object]");b=b.replace(/<param(.*?)>/gi,"[param$1]");b=b.replace(/<img(.*?)style="(.*?)"(.*?)>/gi,"[img$1$3]");b=b.replace(/<(\w+)([\w\W]*?)>/gi,"<$1>");b=b.replace(/<[^\/>][^>]*>(\s*|\t*|\n*|&nbsp;|<br>)<\/[^>]+>/gi,"");b=b.replace(/<[^\/>][^>]*>(\s*|\t*|\n*|&nbsp;|<br>)<\/[^>]+>/gi,"");b=b.replace(/\[td\]/gi,"<td>&nbsp;</td>");b=b.replace(/\[a href="(.*?)"\]([\w\W]*?)\[\/a\]/gi,'<a href="$1">$2</a>');b=b.replace(/\[iframe(.*?)\]([\w\W]*?)\[\/iframe\]/gi,"<iframe$1>$2</iframe>");b=b.replace(/\[video(.*?)\]([\w\W]*?)\[\/video\]/gi,"<video$1>$2</video>");b=b.replace(/\[audio(.*?)\]([\w\W]*?)\[\/audio\]/gi,"<audio$1>$2</audio>");b=b.replace(/\[embed(.*?)\]([\w\W]*?)\[\/embed\]/gi,"<embed$1>$2</embed>");b=b.replace(/\[object(.*?)\]([\w\W]*?)\[\/object\]/gi,"<object$1>$2</object>");b=b.replace(/\[param(.*?)\]/gi,"<param$1>");b=b.replace(/\[img(.*?)\]/gi,"<img$1>");if(this.opts.convertDivs){b=b.replace(/<div(.*?)>([\w\W]*?)<\/div>/gi,"<p>$2</p>")}b=b.replace(/<span>([\w\W]*?)<\/span>/gi,"$1");b=b.replace(/\n{3,}/gi,"\n");b=b.replace(/<p><p>/gi,"<p>");b=b.replace(/<\/p><\/p>/gi,"</p>");if(this.browser("mozilla")){b=b.replace(/<br>$/gi,"")}this.pasteCleanUpInsert(b)},pasteCleanUpInsert:function(a){this.execCommand("inserthtml",a);if(this.opts.autoresize===true){c(this.document.body).scrollTop(this.saveScroll)}else{this.$editor.scrollTop(this.saveScroll)}},formattingRemove:function(b){var f=[];var a=b.match(/<pre(.*?)>([\w\W]*?)<\/pre>/gi);if(a!==null){c.each(a,function(h,e){b=b.replace(e,"prebuffer_"+h);f.push(e)})}b=b.replace(/\s{2,}/g," ");b=b.replace(/\n/g," ");b=b.replace(/[\t]*/g,"");b=b.replace(/\n\s*\n/g,"\n");b=b.replace(/^[\s\n]*/g,"");b=b.replace(/[\s\n]*$/g,"");b=b.replace(/>\s+</g,"><");if(f){c.each(f,function(h,e){b=b.replace("prebuffer_"+h,e)});f=[]}return b},formattingIndenting:function(a){a=a.replace(/<li/g,"\t<li");a=a.replace(/<tr/g,"\t<tr");a=a.replace(/<td/g,"\t\t<td");a=a.replace(/<\/tr>/g,"\t</tr>");return a},formattingEmptyTags:function(a){var b=["<pre></pre>","<blockquote>\\s*</blockquote>","<em>\\s*</em>","<ul></ul>","<ol></ol>","<li></li>","<table></table>","<tr></tr>","<span>\\s*<span>","<span>&nbsp;<span>","<b>\\s*</b>","<b>&nbsp;</b>","<p>\\s*</p>","<p>&nbsp;</p>","<p>\\s*<br>\\s*</p>","<div>\\s*</div>","<div>\\s*<br>\\s*</div>"];for(var g=0;g<b.length;++g){var h=b[g];a=a.replace(new RegExp(h,"gi"),"")}return a},formattingAddBefore:function(h){var b="\r\n";var a=["<p","<form","</ul>","</ol>","<fieldset","<legend","<object","<embed","<select","<option","<input","<textarea","<pre","<blockquote","<ul","<ol","<li","<dl","<dt","<dd","<table","<thead","<tbody","<caption","</caption>","<th","<tr","<td","<figure"];for(var i=0;i<a.length;++i){var j=a[i];h=h.replace(new RegExp(j,"gi"),b+j)}return h},formattingAddAfter:function(h){var a="\r\n";var j=["</p>","</div>","</h1>","</h2>","</h3>","</h4>","</h5>","</h6>","<br>","<br />","</dl>","</dt>","</dd>","</form>","</blockquote>","</pre>","</legend>","</fieldset>","</object>","</embed>","</textarea>","</select>","</option>","</table>","</thead>","</tbody>","</tr>","</td>","</th>","</figure>"];for(var i=0;i<j.length;++i){var b=j[i];h=h.replace(new RegExp(b,"gi"),b+a)}return h},formatting:function(a){a=this.formattingRemove(a);a=this.formattingEmptyTags(a);a=this.formattingAddBefore(a);a=this.formattingAddAfter(a);a=this.formattingIndenting(a);return a},toggle:function(){var a;if(this.opts.visual){var b=this.$editor.innerHeight();this.$editor.hide();this.$content.hide();a=this.$editor.html();this.$el.height(b).val(a).show().focus();this.setBtnActive("html");this.opts.visual=false}else{this.$el.hide();var a=this.$el.val();this.$editor.html(a).show();this.$content.show();if(this.$editor.html()===""){this.setCode(this.opts.emptyHtml)}this.$editor.focus();this.setBtnInactive("html");this.opts.visual=true;this.observeImages();this.observeTables()}},autoSave:function(){this.autosaveInterval=setInterval(c.proxy(function(){c.ajax({url:this.opts.autosave,type:"post",data:this.$el.attr("name")+"="+escape(encodeURIComponent(this.getCode())),success:c.proxy(function(a){if(typeof this.opts.autosaveCallback==="function"){this.opts.autosaveCallback(a,this)}},this)})},this),this.opts.interval*1000)},buildToolbar:function(){if(this.opts.toolbar===false){return false}this.$toolbar=c("<ul>").addClass("redactor_toolbar");if(this.opts.air){c(this.air).append(this.$toolbar);c("body").append(this.air)}else{if(this.opts.toolbarExternal===false){this.$box.prepend(this.$toolbar)}else{c(this.opts.toolbarExternal).html(this.$toolbar)}}c.each(this.opts.buttons,c.proxy(function(b,f){if(f!=="|"&&typeof this.opts.toolbar[f]!=="undefined"){var a=this.opts.toolbar[f];if(this.opts.fileUpload===false&&f==="file"){return true}this.$toolbar.append(c("<li>").append(this.buildButton(f,a)))}if(f==="|"){this.$toolbar.append(c('<li class="redactor_separator"></li>'))}},this))},buildButton:function(g,b){var h=c('<a href="javascript:void(null);" title="'+b.title+'" class="redactor_btn_'+g+'"></a>');if(typeof b.func==="undefined"){h.click(c.proxy(function(){if(c.inArray(g,this.opts.activeButtons)!=-1){this.inactiveAllButtons();this.setBtnActive(g)}if(this.browser("mozilla")){this.$editor.focus()}this.execCommand(b.exec,g)},this))}else{if(b.func!=="show"){h.click(c.proxy(function(e){this[b.func](e)},this))}}if(typeof b.callback!=="undefined"&&b.callback!==false){h.click(c.proxy(function(e){b.callback(this,e,g)},this))}if(g==="backcolor"||g==="fontcolor"||typeof(b.dropdown)!=="undefined"){var a=c('<div class="redactor_dropdown" style="display: none;">');if(g==="backcolor"||g==="fontcolor"){a=this.buildColorPicker(a,g)}else{a=this.buildDropdown(a,b.dropdown)}this.dropdowns.push(a.appendTo(c(document.body)));this.hdlShowDropDown=c.proxy(function(e){this.showDropDown(e,a,g)},this);h.click(this.hdlShowDropDown)}return h},buildDropdown:function(a,b){c.each(b,c.proxy(function(j,h){if(typeof(h.className)==="undefined"){h.className=""}var i;if(typeof h.name!=="undefined"&&h.name==="separator"){i=c('<a class="redactor_separator_drop">')}else{i=c('<a href="javascript:void(null);" class="'+h.className+'">'+h.title+"</a>");if(typeof(h.callback)==="function"){c(i).click(c.proxy(function(e){h.callback(this,e,j)},this))}else{if(typeof(h.func)==="undefined"){c(i).click(c.proxy(function(){this.execCommand(h.exec,j)},this))}else{c(i).click(c.proxy(function(e){this[h.func](e)},this))}}}c(a).append(i)},this));return a},buildColorPicker:function(a,b){var o;if(b==="backcolor"){if(this.browser("msie")){o="BackColor"}else{o="hilitecolor"}}else{o="forecolor"}c(a).width(210);var n=this.opts.colors.length;for(var p=0;p<n;++p){var s=this.opts.colors[p];var i=c('<a rel="'+s+'" href="javascript:void(null);" class="redactor_color_link"></a>').css({backgroundColor:s});c(a).append(i);var m=this;c(i).click(function(){m.execCommand(o,c(this).attr("rel"));if(o==="forecolor"){m.$editor.find("font").replaceWith(function(){return c('<span style="color: '+c(this).attr("color")+';">'+c(this).html()+"</span>")})}if(m.browser("msie")&&o==="BackColor"){m.$editor.find("font").replaceWith(function(){return c('<span style="'+c(this).attr("style")+'">'+c(this).html()+"</span>")})}})}var q=c('<a href="javascript:void(null);" class="redactor_color_none"></a>').html(RLANG.none);if(b==="backcolor"){q.click(c.proxy(this.setBackgroundNone,this))}else{q.click(c.proxy(this.setColorNone,this))}c(a).append(q);return a},setBackgroundNone:function(){c(this.getParentNode()).css("background-color","transparent");this.syncCode()},setColorNone:function(){c(this.getParentNode()).attr("color","").css("color","");this.syncCode()},showDropDown:function(b,a,m){if(this.getBtn(m).hasClass("dropact")){this.hideAllDropDown()}else{this.hideAllDropDown();this.setBtnActive(m);this.getBtn(m).addClass("dropact");var e=this.getBtn(m).offset().left;if(this.opts.air){var l=this.air.offset().top;c(a).css({position:"absolute",left:e+"px",top:l+30+"px"}).show()}else{if(this.opts.fixed&&this.fixed){c(a).css({position:"fixed",left:e+"px",top:"30px"}).show()}else{var k=this.$toolbar.offset().top+30;c(a).css({position:"absolute",left:e+"px",top:k+"px"}).show()}}}var n=c.proxy(function(f){this.hideDropDown(f,a,m)},this);c(document).one("click",n);this.$editor.one("click",n);this.$content.one("click",n);b.stopPropagation()},hideAllDropDown:function(){this.$toolbar.find("a.dropact").removeClass("redactor_act").removeClass("dropact");c(".redactor_dropdown").hide()},hideDropDown:function(b,a,e){if(!c(b.target).hasClass("dropact")){c(a).removeClass("dropact");this.showedDropDown=false;this.hideAllDropDown()}},getBtn:function(a){if(this.opts.toolbar===false){return false}return c(this.$toolbar.find("a.redactor_btn_"+a))},setBtnActive:function(a){this.getBtn(a).addClass("redactor_act")},setBtnInactive:function(a){this.getBtn(a).removeClass("redactor_act")},inactiveAllButtons:function(){c.each(this.opts.activeButtons,c.proxy(function(b,a){this.setBtnInactive(a)},this))},changeBtnIcon:function(b,a){this.getBtn(b).addClass("redactor_btn_"+a)},removeBtnIcon:function(b,a){this.getBtn(b).removeClass("redactor_btn_"+a)},addBtnSeparator:function(){this.$toolbar.append(c('<li class="redactor_separator"></li>'))},addBtnSeparatorAfter:function(b){var a=this.getBtn(b);a.parent().after(c('<li class="redactor_separator"></li>'))},addBtnSeparatorBefore:function(b){var a=this.getBtn(b);a.parent().before(c('<li class="redactor_separator"></li>'))},removeBtnSeparatorAfter:function(b){var a=this.getBtn(b);a.parent().next().remove()},removeBtnSeparatorBefore:function(b){var a=this.getBtn(b);a.parent().prev().remove()},setBtnRight:function(a){if(this.opts.toolbar===false){return false}this.getBtn(a).parent().addClass("redactor_btn_right")},setBtnLeft:function(a){if(this.opts.toolbar===false){return false}this.getBtn(a).parent().removeClass("redactor_btn_right")},addBtn:function(i,h,a,b){if(this.opts.toolbar===false){return false}var j=this.buildButton(i,{title:h,callback:a,dropdown:b});this.$toolbar.append(c("<li>").append(j))},addBtnFirst:function(i,h,a,b){if(this.opts.toolbar===false){return false}var j=this.buildButton(i,{title:h,callback:a,dropdown:b});this.$toolbar.prepend(c("<li>").append(j))},addBtnAfter:function(a,m,k,b,j){if(this.opts.toolbar===false){return false}var n=this.buildButton(m,{title:k,callback:b,dropdown:j});var l=this.getBtn(a);l.parent().after(c("<li>").append(n))},addBtnBefore:function(j,m,k,a,b){if(this.opts.toolbar===false){return false}var n=this.buildButton(m,{title:k,callback:a,dropdown:b});var l=this.getBtn(j);l.parent().before(c("<li>").append(n))},removeBtn:function(f,a){var b=this.getBtn(f);if(a===true){b.parent().next().remove()}b.parent().removeClass("redactor_btn_right");b.remove()},getFragmentHtml:function(b){var f=b.cloneNode(true);var a=this.document.createElement("div");a.appendChild(f);return a.innerHTML},extractContent:function(){var f=this.$editor.get(0);var a=this.document.createDocumentFragment(),b;while((b=f.firstChild)){a.appendChild(b)}return a},saveSelection:function(){this.$editor.focus();this.savedSel=this.getOrigin();this.savedSelObj=this.getFocus()},restoreSelection:function(){if(typeof this.savedSel!=="undefined"&&this.savedSel!==null&&this.savedSelObj!==null&&this.savedSel[0].tagName!=="BODY"){if(this.opts.iframe===false&&c(this.savedSel[0]).closest(".redactor_editor").size()==0){this.$editor.focus()}else{if(this.browser("opera")){this.$editor.focus()}this.setSelection(this.savedSel[0],this.savedSel[1],this.savedSelObj[0],this.savedSelObj[1]);if(this.browser("mozilla")){this.$editor.focus()}}}else{this.$editor.focus()}},getSelection:function(){var a=this.document;if(this.window.getSelection){return this.window.getSelection()}else{if(a.getSelection){return a.getSelection()}else{return a.selection.createRange()}}return false},hasSelection:function(){if(!this.oldIE()){var a;return(a=this.getSelection())&&(a.focusNode!=null)&&(a.anchorNode!=null)}else{var b=this.$editor.get(0);var f;b.focus();if(!b.document.selection){return false}f=b.document.selection.createRange();return f&&f.parentElement().document===b.document}},getOrigin:function(){if(!this.oldIE()){var a;if(!((a=this.getSelection())&&(a.anchorNode!=null))){return null}return[a.anchorNode,a.anchorOffset]}else{var b=this.$editor.get(0);var f;b.focus();if(!this.hasSelection()){return null}f=b.document.selection.createRange();return this._getBoundary(b.document,f,true)}},getFocus:function(){if(!this.oldIE()){var a;if(!((a=this.getSelection())&&(a.focusNode!=null))){return null}return[a.focusNode,a.focusOffset]}else{var b=this.$editor.get(0);var f;b.focus();if(!this.hasSelection()){return null}f=b.document.selection.createRange();return this._getBoundary(b.document,f,false)}},setSelection:function(a,b,e,m){if(e==null){e=a}if(m==null){m=b}if(!this.oldIE()){var n=this.getSelection();if(!n){return}if(n.collapse&&n.extend){n.collapse(a,b);n.extend(e,m)}else{r=this.document.createRange();r.setStart(a,b);r.setEnd(e,m);try{n.removeAllRanges()}catch(l){}n.addRange(r)}}else{var o=this.$editor.get(0);var p=o.document.body.createTextRange();this._moveBoundary(o.document,p,false,e,m);this._moveBoundary(o.document,p,true,a,b);return p.select()}},getCurrentNode:function(){if(typeof this.window.getSelection!=="undefined"){return this.getSelectedNode().parentNode}else{if(typeof this.document.selection!=="undefined"){return this.getSelection().parentElement()}}},getParentNode:function(){return c(this.getCurrentNode()).parent()[0]},getSelectedNode:function(){if(this.oldIE()){return this.getSelection().parentElement()}else{if(typeof this.window.getSelection!=="undefined"){var a=this.window.getSelection();if(a.rangeCount>0){return this.getSelection().getRangeAt(0).commonAncestorContainer}else{return false}}else{if(typeof this.document.selection!=="undefined"){return this.getSelection()}}}},_getBoundary:function(k,m,l){var a,p,n,b,o;p=k.createElement("a");a=m.duplicate();a.collapse(l);o=a.parentElement();while(true){o.insertBefore(p,p.previousSibling);a.moveToElementText(p);if(!(a.compareEndPoints((l?"StartToStart":"StartToEnd"),m)>0&&(p.previousSibling!=null))){break}}if(a.compareEndPoints((l?"StartToStart":"StartToEnd"),m)===-1&&p.nextSibling){a.setEndPoint((l?"EndToStart":"EndToEnd"),m);n=p.nextSibling;b=a.text.length}else{n=p.parentNode;b=this._getChildIndex(p)}p.parentNode.removeChild(p);return[n,b]},_moveBoundary:function(o,a,b,s,q){var n,p,m,u,t;t=0;n=this._isText(s)?s:s.childNodes[q];p=this._isText(s)?s.parentNode:s;if(this._isText(s)){t=q}u=o.createElement("a");p.insertBefore(u,n||null);m=o.body.createTextRange();m.moveToElementText(u);u.parentNode.removeChild(u);a.setEndPoint((b?"StartToStart":"EndToEnd"),m);return a[b?"moveStart":"moveEnd"]("character",t)},_isText:function(a){return(a!=null?a.nodeType==3:false)},_getChildIndex:function(a){var b=0;while(a=a.previousSibling){b++}return b},insertNodeAfterCaret:function(a){this.saveSelection();this.insertNodeAtCaret(a);this.restoreSelection()},insertNodeAtCaret:function(j){if(this.window.getSelection){var b=this.getSelection();if(b.rangeCount){var m=b.getRangeAt(0);m.collapse(false);m.insertNode(j);m=m.cloneRange();m.selectNodeContents(j);m.collapse(false);b.removeAllRanges();b.addRange(m)}}else{if(this.document.selection){var l=(j.nodeType===1)?j.outerHTML:j.data;var a="marker_"+(""+Math.random()).slice(2);l+='<span id="'+a+'"></span>';var k=this.getSelection();k.collapse(false);k.pasteHTML(l);var n=this.document.getElementById(a);k.moveToElementText(n);k.select();n.parentNode.removeChild(n)}}},getSelectedHtml:function(){var b="";if(this.window.getSelection){var a=this.window.getSelection();if(a.rangeCount){var i=this.document.createElement("div");for(var h=0,j=a.rangeCount;h<j;++h){i.appendChild(a.getRangeAt(h).cloneContents())}b=i.innerHTML}}else{if(this.document.selection){if(this.document.selection.type==="Text"){b=this.document.selection.createRange().htmlText}}}return b},resizeImage:function(l){var k=false;var o=false;var m;var p;var b=c(l).width()/c(l).height();var n=10;var a=10;c(l).off("hover mousedown mouseup click mousemove");c(l).hover(function(){c(l).css("cursor","nw-resize")},function(){c(l).css("cursor","");k=false});c(l).mousedown(function(e){e.preventDefault();b=c(l).width()/c(l).height();k=true;o=true;m=Math.round(e.pageX-c(l).eq(0).offset().left);p=Math.round(e.pageY-c(l).eq(0).offset().top)});c(l).mouseup(c.proxy(function(e){k=false;c(l).css("cursor","");this.syncCode()},this));c(l).click(c.proxy(function(e){if(o){this.imageEdit(e)}},this));c(l).mousemove(function(i){if(k){o=false;var f=Math.round(i.pageX-c(this).eq(0).offset().left)-m;var g=Math.round(i.pageY-c(this).eq(0).offset().top)-p;var j=c(l).height();var h=parseInt(j,10)+g;var e=h*b;if(e>n){c(l).width(e)}if(h>a){c(l).height(h)}m=Math.round(i.pageX-c(this).eq(0).offset().left);p=Math.round(i.pageY-c(this).eq(0).offset().top)}})},showTable:function(){this.saveSelection();this.modalInit(RLANG.table,this.opts.modal_table,300,c.proxy(function(){c("#redactor_insert_table_btn").click(c.proxy(this.insertTable,this));setTimeout(function(){c("#redactor_table_rows").focus()},200)},this))},insertTable:function(){var a=c("#redactor_table_rows").val();var q=c("#redactor_table_columns").val();var u=c("<div></div>");var t=Math.floor(Math.random()*99999);var i=c('<table id="table'+t+'"><tbody></tbody></table>');for(var p=0;p<a;p++){var b=c("<tr></tr>");for(var n=0;n<q;n++){var s=c("<td><br></td>");c(b).append(s)}c(i).append(b)}c(u).append(i);var o=c(u).html()+"<p></p>";this.restoreSelection();this.execCommand("inserthtml",o);this.modalClose();this.observeTables()},tableObserver:function(a){this.$table=c(a.target).closest("table");this.$table_tr=this.$table.find("tr");this.$table_td=this.$table.find("td");this.$tbody=c(a.target).closest("tbody");this.$thead=c(this.$table).find("thead");this.$current_td=c(a.target);this.$current_tr=c(a.target).closest("tr")},deleteTable:function(){c(this.$table).remove();this.$table=false;this.syncCode()},deleteRow:function(){c(this.$current_tr).remove();this.syncCode()},deleteColumn:function(){var a=c(this.$current_td).get(0).cellIndex;c(this.$table).find("tr").each(function(){c(this).find("td").eq(a).remove()});this.syncCode()},addHead:function(){if(c(this.$table).find("thead").size()!==0){this.deleteHead()}else{var a=c(this.$table).find("tr").first().clone();a.find("td").html("&nbsp;");this.$thead=c("<thead></thead>");this.$thead.append(a);c(this.$table).prepend(this.$thead);this.syncCode()}},deleteHead:function(){c(this.$thead).remove();this.$thead=false;this.syncCode()},insertRowAbove:function(){this.insertRow("before")},insertRowBelow:function(){this.insertRow("after")},insertColumnLeft:function(){this.insertColumn("before")},insertColumnRight:function(){this.insertColumn("after")},insertRow:function(b){var a=c(this.$current_tr).clone();a.find("td").html("&nbsp;");if(b==="after"){c(this.$current_tr).after(a)}else{c(this.$current_tr).before(a)}this.syncCode()},insertColumn:function(a){var b=0;this.$current_tr.find("td").each(c.proxy(function(h,g){if(c(g)[0]===this.$current_td[0]){b=h}},this));this.$table_tr.each(function(l,k){var j=c(k).find("td").eq(b);var i=j.clone();i.html("&nbsp;");if(a==="after"){c(j).after(i)}else{c(j).before(i)}});this.syncCode()},showVideo:function(){this.saveSelection();this.modalInit(RLANG.video,this.opts.modal_video,600,c.proxy(function(){c("#redactor_insert_video_btn").click(c.proxy(this.insertVideo,this));setTimeout(function(){c("#redactor_insert_video_area").focus()},200)},this))},insertVideo:function(){var a=c("#redactor_insert_video_area").val();a=this.stripTags(a);this.restoreSelection();this.execCommand("inserthtml",a);this.modalClose()},imageEdit:function(b){var h=c(b.target);var e=h.parent();var a=c.proxy(function(){c("#redactor_file_alt").val(h.attr("alt"));c("#redactor_image_edit_src").attr("href",h.attr("src"));c("#redactor_form_image_align").val(h.css("float"));if(c(e).get(0).tagName==="A"){c("#redactor_file_link").val(c(e).attr("href"))}c("#redactor_image_delete_btn").click(c.proxy(function(){this.imageDelete(h)},this));c("#redactorSaveBtn").click(c.proxy(function(){this.imageSave(h)},this))},this);this.modalInit(RLANG.image,this.opts.modal_image_edit,380,a)},imageDelete:function(a){c(a).remove();this.modalClose();this.syncCode()},imageSave:function(g){var h=c(g).parent();c(g).attr("alt",c("#redactor_file_alt").val());var a=c("#redactor_form_image_align").val();if(a==="left"){c(g).css({"float":"left",margin:"0 10px 10px 0"})}else{if(a==="right"){c(g).css({"float":"right",margin:"0 0 10px 10px"})}else{c(g).css({"float":"none",margin:"0"})}}var b=c.trim(c("#redactor_file_link").val());if(b!==""){if(c(h).get(0).tagName!=="A"){c(g).replaceWith('<a href="'+b+'">'+this.outerHTML(g)+"</a>")}else{c(h).attr("href",b)}}else{if(c(h).get(0).tagName==="A"){c(h).replaceWith(this.outerHTML(g))}}this.modalClose();this.observeImages();this.syncCode()},showImage:function(){this.saveSelection();var a=c.proxy(function(){if(this.opts.imageGetJson!==false){c.getJSON(this.opts.imageGetJson,c.proxy(function(m){var o={};var k=0;c.each(m,c.proxy(function(f,e){if(typeof e.folder!=="undefined"){k++;o[e.folder]=k}},this));var n=false;c.each(m,c.proxy(function(i,h){var e="";if(typeof h.title!=="undefined"){e=h.title}var g=0;if(!c.isEmptyObject(o)&&typeof h.folder!=="undefined"){g=o[h.folder];if(n===false){n=".redactorfolder"+g}}var f=c('<img src="'+h.thumb+'" class="redactorfolder redactorfolder'+g+'" rel="'+h.image+'" title="'+e+'" />');c("#redactor_image_box").append(f);c(f).click(c.proxy(this.imageSetThumb,this))},this));if(!c.isEmptyObject(o)){c(".redactorfolder").hide();c(n).show();var l=function(e){c(".redactorfolder").hide();c(".redactorfolder"+c(e.target).val()).show()};var p=c('<select id="redactor_image_box_select">');c.each(o,function(e,f){p.append(c('<option value="'+f+'">'+e+"</option>"))});c("#redactor_image_box").before(p);p.change(l)}},this))}else{c("#redactor_tabs a").eq(1).remove()}if(this.opts.imageUpload!==false){if(this.opts.uploadCrossDomain===false&&this.isMobile()===false){if(c("#redactor_file").size()!==0){c("#redactor_file").dragupload({url:this.opts.imageUpload,uploadFields:this.opts.uploadFields,success:c.proxy(this.imageUploadCallback,this),error:c.proxy(this.opts.imageUploadErrorCallback,this)})}}this.uploadInit("redactor_file",{auto:true,url:this.opts.imageUpload,success:c.proxy(this.imageUploadCallback,this),error:c.proxy(this.opts.imageUploadErrorCallback,this)})}else{c(".redactor_tab").hide();if(this.opts.imageGetJson===false){c("#redactor_tabs").remove();c("#redactor_tab3").show()}else{var b=c("#redactor_tabs a");b.eq(0).remove();b.eq(1).addClass("redactor_tabs_act");c("#redactor_tab2").show()}}c("#redactor_upload_btn").click(c.proxy(this.imageUploadCallbackLink,this));if(this.opts.imageUpload===false&&this.opts.imageGetJson===false){setTimeout(function(){c("#redactor_file_link").focus()},200)}},this);this.modalInit(RLANG.image,this.opts.modal_image,610,a)},imageSetThumb:function(a){this._imageSet('<img src="'+c(a.target).attr("rel")+'" alt="'+c(a.target).attr("title")+'" />',true)},imageUploadCallbackLink:function(){if(c("#redactor_file_link").val()!==""){var a='<img src="'+c("#redactor_file_link").val()+'" />';this._imageSet(a,true)}else{this.modalClose()}},imageUploadCallback:function(a){this._imageSet(a)},_imageSet:function(b,a){this.restoreSelection();if(b!==false){var f="";if(a!==true){f='<p><img src="'+b.filelink+'" /></p>'}else{f=b}this.execCommand("inserthtml",f);if(a!==true&&typeof this.opts.imageUploadCallback==="function"){this.opts.imageUploadCallback(this,b)}}this.modalClose();this.observeImages()},showLink:function(){this.saveSelection();var a=c.proxy(function(){this.insert_link_node=false;var l=this.getSelection();var p="",b="",k="";if(this.browser("msie")){var n=this.getParentNode();if(n.nodeName==="A"){this.insert_link_node=c(n);b=this.insert_link_node.text();p=this.insert_link_node.attr("href");k=this.insert_link_node.attr("target")}else{if(this.oldIE()){b=l.text}else{b=l.toString()}}}else{if(l&&l.anchorNode&&l.anchorNode.parentNode.tagName==="A"){p=l.anchorNode.parentNode.href;b=l.anchorNode.parentNode.text;k=l.anchorNode.parentNode.target;if(l.toString()===""){this.insert_link_node=l.anchorNode.parentNode}}else{b=l.toString()}}c(".redactor_link_text").val(b);var o=self.location.href.replace(/\/$/i,"");var m=p.replace(o,"");if(p.search("mailto:")===0){this.setModalTab(2);c("#redactor_tab_selected").val(2);c("#redactor_link_mailto").val(p.replace("mailto:",""))}else{if(m.search(/^#/gi)===0){this.setModalTab(3);c("#redactor_tab_selected").val(3);c("#redactor_link_anchor").val(m.replace(/^#/gi,""))}else{c("#redactor_link_url").val(m)}}if(k==="_blank"){c("#redactor_link_blank").attr("checked",true)}c("#redactor_insert_link_btn").click(c.proxy(this.insertLink,this));setTimeout(function(){c("#redactor_link_url").focus()},200)},this);this.modalInit(RLANG.link,this.opts.modal_link,460,a)},insertLink:function(){var j=c("#redactor_tab_selected").val();var l="",a="",b="";if(j==="1"){l=c("#redactor_link_url").val();a=c("#redactor_link_url_text").val();if(c("#redactor_link_blank").attr("checked")){b=' target="_blank"'}var k="/(w+:{0,1}w*@)?(S+)(:[0-9]+)?(/|/([w#!:.?+=&%@!-/]))?/";var m=new RegExp("^(http|ftp|https)://"+k,"i");var n=new RegExp("^"+k,"i");if(l.search(m)==-1&&l.search(n)==0&&this.opts.protocol!==false){l=this.opts.protocol+l}}else{if(j==="2"){l="mailto:"+c("#redactor_link_mailto").val();a=c("#redactor_link_mailto_text").val()}else{if(j==="3"){l="#"+c("#redactor_link_anchor").val();a=c("#redactor_link_anchor_text").val()}}}this._insertLink('<a href="'+l+'"'+b+">"+a+"</a>",c.trim(a),l,b)},_insertLink:function(h,a,g,b){this.$editor.focus();this.restoreSelection();if(a!==""){if(this.insert_link_node){c(this.insert_link_node).text(a);c(this.insert_link_node).attr("href",g);if(b!==""){c(this.insert_link_node).attr("target",b)}else{c(this.insert_link_node).removeAttr("target")}this.syncCode()}else{this.execCommand("inserthtml",h)}}this.modalClose()},showFile:function(){this.saveSelection();var a=c.proxy(function(){var f=this.getSelection();var b="";if(this.oldIE()){b=f.text}else{b=f.toString()}c("#redactor_filename").val(b);if(this.opts.uploadCrossDomain===false&&this.isMobile()===false){c("#redactor_file").dragupload({url:this.opts.fileUpload,uploadFields:this.opts.uploadFields,success:c.proxy(this.fileUploadCallback,this),error:c.proxy(this.opts.fileUploadErrorCallback,this)})}this.uploadInit("redactor_file",{auto:true,url:this.opts.fileUpload,success:c.proxy(this.fileUploadCallback,this),error:c.proxy(this.opts.fileUploadErrorCallback,this)})},this);this.modalInit(RLANG.file,this.opts.modal_file,500,a)},fileUploadCallback:function(f){this.restoreSelection();if(f!==false){var a=c("#redactor_filename").val();if(a===""){a=f.filename}var b='<a href="'+f.filelink+'">'+a+"</a>";if(this.browser("webkit")&&!!this.window.chrome){b=b+"&nbsp;"}this.execCommand("inserthtml",b);if(typeof this.opts.fileUploadCallback==="function"){this.opts.fileUploadCallback(this,f)}}this.modalClose()},modalInit:function(b,h,j,a){if(c("#redactor_modal_overlay").size()===0){this.overlay=c('<div id="redactor_modal_overlay" style="display: none;"></div>');c("body").prepend(this.overlay)}if(this.opts.overlay){c("#redactor_modal_overlay").show();c("#redactor_modal_overlay").click(c.proxy(this.modalClose,this))}if(c("#redactor_modal").size()===0){this.modal=c('<div id="redactor_modal" style="display: none;"><div id="redactor_modal_close">&times;</div><div id="redactor_modal_header"></div><div id="redactor_modal_inner"></div></div>');c("body").append(this.modal)}c("#redactor_modal_close").click(c.proxy(this.modalClose,this));this.hdlModalClose=c.proxy(function(e){if(e.keyCode===27){this.modalClose();return false}},this);c(document).keyup(this.hdlModalClose);this.$editor.keyup(this.hdlModalClose);if(h.indexOf("#")==0){c("#redactor_modal_inner").empty().append(c(h).html())}else{c("#redactor_modal_inner").empty().append(h)}c("#redactor_modal_header").html(b);if(typeof c.fn.draggable!=="undefined"){c("#redactor_modal").draggable({handle:"#redactor_modal_header"});c("#redactor_modal_header").css("cursor","move")}if(c("#redactor_tabs").size()!==0){var i=this;c("#redactor_tabs a").each(function(f,e){f++;c(e).click(function(){c("#redactor_tabs a").removeClass("redactor_tabs_act");c(this).addClass("redactor_tabs_act");c(".redactor_tab").hide();c("#redactor_tab"+f).show();c("#redactor_tab_selected").val(f);if(i.isMobile()===false){var g=c("#redactor_modal").outerHeight();c("#redactor_modal").css("margin-top","-"+(g+10)/2+"px")}})})}c("#redactor_modal .redactor_btn_modal_close").click(c.proxy(this.modalClose,this));if(this.isMobile()===false){c("#redactor_modal").css({position:"fixed",top:"-2000px",left:"50%",width:j+"px",marginLeft:"-"+(j+60)/2+"px"}).show();this.modalSaveBodyOveflow=c(document.body).css("overflow");c(document.body).css("overflow","hidden")}else{c("#redactor_modal").css({position:"fixed",width:"100%",height:"100%",top:"0",left:"0",margin:"0",minHeight:"300px"}).show()}if(typeof a==="function"){a()}if(this.isMobile()===false){setTimeout(function(){var e=c("#redactor_modal").outerHeight();c("#redactor_modal").css({top:"50%",height:"auto",minHeight:"auto",marginTop:"-"+(e+10)/2+"px"})},20)}},modalClose:function(){c("#redactor_modal_close").unbind("click",this.modalClose);c("#redactor_modal").fadeOut("fast",c.proxy(function(){c("#redactor_modal_inner").html("");if(this.opts.overlay){c("#redactor_modal_overlay").hide();c("#redactor_modal_overlay").unbind("click",this.modalClose)}c(document).unbind("keyup",this.hdlModalClose);this.$editor.unbind("keyup",this.hdlModalClose)},this));if(this.isMobile()===false){c(document.body).css("overflow",this.modalSaveBodyOveflow?this.modalSaveBodyOveflow:"visible")}return false},setModalTab:function(b){c(".redactor_tab").hide();var a=c("#redactor_tabs a");a.removeClass("redactor_tabs_act");a.eq(b-1).addClass("redactor_tabs_act");c("#redactor_tab"+b).show()},uploadInit:function(a,b){this.uploadOptions={url:false,success:false,error:false,start:false,trigger:false,auto:false,input:false};c.extend(this.uploadOptions,b);if(c("#"+a).size()!==0&&c("#"+a).get(0).tagName==="INPUT"){this.uploadOptions.input=c("#"+a);this.element=c(c("#"+a).get(0).form)}else{this.element=c("#"+a)}this.element_action=this.element.attr("action");if(this.uploadOptions.auto){c(this.uploadOptions.input).change(c.proxy(function(){this.element.submit(function(e){return false});this.uploadSubmit()},this))}else{if(this.uploadOptions.trigger){c("#"+this.uploadOptions.trigger).click(c.proxy(this.uploadSubmit,this))}}},uploadSubmit:function(){this.uploadForm(this.element,this.uploadFrame())},uploadFrame:function(){this.id="f"+Math.floor(Math.random()*99999);var a=this.document.createElement("div");var b='<iframe style="display:none" id="'+this.id+'" name="'+this.id+'"></iframe>';a.innerHTML=b;c(a).appendTo("body");if(this.uploadOptions.start){this.uploadOptions.start()}c("#"+this.id).load(c.proxy(this.uploadLoaded,this));return this.id},uploadForm:function(f,j){if(this.uploadOptions.input){var b="redactorUploadForm"+this.id;var l="redactorUploadFile"+this.id;this.form=c('<form  action="'+this.uploadOptions.url+'" method="POST" target="'+j+'" name="'+b+'" id="'+b+'" enctype="multipart/form-data"></form>');if(this.opts.uploadFields!==false&&typeof this.opts.uploadFields==="object"){c.each(this.opts.uploadFields,c.proxy(function(g,h){if(h.toString().indexOf("#")===0){h=c(h).val()}var e=c("<input/>",{type:"hidden",name:g,value:h});c(this.form).append(e)},this))}var k=this.uploadOptions.input;var a=c(k).clone();c(k).attr("id",l);c(k).before(a);c(k).appendTo(this.form);c(this.form).css("position","absolute");c(this.form).css("top","-2000px");c(this.form).css("left","-2000px");c(this.form).appendTo("body");this.form.submit()}else{f.attr("target",j);f.attr("method","POST");f.attr("enctype","multipart/form-data");f.attr("action",this.uploadOptions.url);this.element.submit()}},uploadLoaded:function(){var b=c("#"+this.id)[0];var a;if(b.contentDocument){a=b.contentDocument}else{if(b.contentWindow){a=b.contentWindow.document}else{a=window.frames[this.id].document}}if(this.uploadOptions.success){if(typeof a!=="undefined"){var i=a.body.innerHTML;var j=i.match(/\{(.|\n)*\}/)[0];var k=c.parseJSON(j);if(typeof k.error=="undefined"){this.uploadOptions.success(k)}else{this.uploadOptions.error(this,k);this.modalClose()}}else{alert("Upload failed!");this.modalClose()}}this.element.attr("action",this.element_action);this.element.attr("target","")},browser:function(b){var a=navigator.userAgent.toLowerCase();var f=/(chrome)[ \/]([\w.]+)/.exec(a)||/(webkit)[ \/]([\w.]+)/.exec(a)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(a)||/(msie) ([\w.]+)/.exec(a)||a.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(a)||[];if(b=="version"){return f[2]}if(b=="webkit"){return(f[1]=="chrome"||f[1]=="webkit")}return f[1]==b},oldIE:function(){if(this.browser("msie")&&parseInt(this.browser("version"),10)<9){return true}return false},outerHTML:function(a){return c("<p>").append(c(a).eq(0).clone()).html()},normalize:function(a){return parseInt(a.replace("px",""),10)},isMobile:function(a){if(a===true&&/(iPhone|iPod|iPad|BlackBerry|Android)/.test(navigator.userAgent)){return true}else{if(/(iPhone|iPod|BlackBerry|Android)/.test(navigator.userAgent)){return true}else{return false}}}};c.fn.getObject=function(){return this.data("redactor")};c.fn.getEditor=function(){return this.data("redactor").$editor};c.fn.getCode=function(){return c.trim(this.data("redactor").getCode())};c.fn.getText=function(){return this.data("redactor").$editor.text()};c.fn.getSelected=function(){return this.data("redactor").getSelectedHtml()};c.fn.setCode=function(a){this.data("redactor").setCode(a)};c.fn.insertHtml=function(a){this.data("redactor").insertHtml(a)};c.fn.destroyEditor=function(){this.each(function(){if(typeof c(this).data("redactor")!="undefined"){c(this).data("redactor").destroy();c(this).removeData("redactor")}})};c.fn.setFocus=function(){this.data("redactor").$editor.focus()};c.fn.execCommand=function(b,a){this.data("redactor").execCommand(b,a)}})(jQuery);(function(c){c.fn.dragupload=function(a){return this.each(function(){var b=new d(this,a);b.init()})};function d(a,b){this.opts=c.extend({url:false,success:false,error:false,preview:false,uploadFields:false,text:RLANG.drop_file_here,atext:RLANG.or_choose},b);this.$el=c(a)}d.prototype={init:function(){if(navigator.userAgent.search("MSIE")===-1){this.droparea=c('<div class="redactor_droparea"></div>');this.dropareabox=c('<div class="redactor_dropareabox">'+this.opts.text+"</div>");this.dropalternative=c('<div class="redactor_dropalternative">'+this.opts.atext+"</div>");this.droparea.append(this.dropareabox);this.$el.before(this.droparea);this.$el.before(this.dropalternative);this.dropareabox.bind("dragover",c.proxy(function(){return this.ondrag()},this));this.dropareabox.bind("dragleave",c.proxy(function(){return this.ondragleave()},this));var a=c.proxy(function(e){var h=parseInt(e.loaded/e.total*100,10);this.dropareabox.text("Loading "+h+"%")},this);var b=jQuery.ajaxSettings.xhr();if(b.upload){b.upload.addEventListener("progress",a,false)}var f=function(){return b};this.dropareabox.get(0).ondrop=c.proxy(function(e){e.preventDefault();this.dropareabox.removeClass("hover").addClass("drop");var i=e.dataTransfer.files[0];var j=new FormData();if(this.opts.uploadFields!==false&&typeof this.opts.uploadFields==="object"){c.each(this.opts.uploadFields,c.proxy(function(g,h){if(h.toString().indexOf("#")===0){h=c(h).val()}j.append(g,h)},this))}j.append("file",i);c.ajax({url:this.opts.url,dataType:"html",data:j,xhr:f,cache:false,contentType:false,processData:false,type:"POST",success:c.proxy(function(g){var h=c.parseJSON(g);if(typeof h.error=="undefined"){this.opts.success(h)}else{this.opts.error(this,h);this.opts.success(false)}},this)})},this)}},ondrag:function(){this.dropareabox.addClass("hover");return false},ondragleave:function(){this.dropareabox.removeClass("hover");return false}}})(jQuery);(function(f){var h="http://";var i=/(^|&lt;|\s)(www\..+?\..+?)(\s|&gt;|$)/g,g=/(^|&lt;|\s)(((https?|ftp):\/\/|mailto:).+?)(\s|&gt;|$)/g,j=function(){var b=this.childNodes,c=b.length;while(c--){var a=b[c];if(a.nodeType===3){var d=a.nodeValue;if(d){d=d.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(i,'$1<a href="'+h+'$2">$2</a>$3').replace(g,'$1<a href="$2">$2</a>$5');f(a).after(d).remove()}}else{if(a.nodeType===1&&!/^(a|button|textarea)$/i.test(a.tagName)){j.call(a)}}}};f.fn.linkify=function(){this.each(j)}})(jQuery);eval(function(e,a,c,l,k,d){k=function(b){return(b<a?"":k(parseInt(b/a)))+((b=b%a)>35?String.fromCharCode(b+29):b.toString(36))};if(!"".replace(/^/,String)){while(c--){d[k(c)]=l[c]||k(c)}l=[function(b){return d[b]}];k=function(){return"\\w+"};c=1}while(c--){if(l[c]){e=e.replace(new RegExp("\\b"+k(c)+"\\b","g"),l[c])}}return e}('(5($){$.1.4.7={t:5(0,v){$(2).0("8",c);$(2).0("r",0);$(2).l(\'g\',$.1.4.7.b)},u:5(0){$(2).w(\'g\',$.1.4.7.b)},b:5(1){9 0=$(2).0("r");9 3=$.1.4.7.f(0).h();6(3!=\'\'){$(2).0("8",x);1.j="7";1.3=3;$.1.i.m(2,k)}},f:5(0){9 3=\'\';6(q.e){3=q.e()}o 6(d.e){3=d.e()}o 6(d.p){3=d.p.B().3}A 3}};$.1.4.a={t:5(0,v){$(2).0("n",0);$(2).0("8",c);$(2).l(\'g\',$.1.4.a.b);$(2).l(\'D\',$.1.4.a.s)},u:5(0){$(2).w(\'g\',$.1.4.a.b)},b:5(1){6($(2).0("8")){9 0=$(2).0("n");9 3=$.1.4.7.f(0).h();6(3==\'\'){$(2).0("8",c);1.j="a";$.1.i.m(2,k)}}},s:5(1){6($(2).0("8")){9 0=$(2).0("n");9 3=$.1.4.7.f(0).h();6((1.y=z)&&(3==\'\')){$(2).0("8",c);1.j="a";$.1.i.m(2,k)}}}}})(C);',40,40,"data|event|this|text|special|function|if|textselect|textselected|var|textunselect|handler|false|rdocument|getSelection|getSelectedText|mouseup|toString|handle|type|arguments|bind|apply|rttt|else|selection|rwindow|ttt|handlerKey|setup|teardown|namespaces|unbind|true|keyCode|27|return|createRange|jQuery|keyup".split("|"),0,{}));